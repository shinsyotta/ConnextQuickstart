"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const hdnode_1 = require("ethers/utils/hdnode");
const constants_1 = require("./constants");
const xkeys_1 = require("./machine/xkeys");
const utils_1 = require("./utils");
exports.EXTENDED_PRIVATE_KEY_PATH = "EXTENDED_PRIVATE_KEY";
async function getHDNode(storeService) {
    let xprv = await storeService.get(exports.EXTENDED_PRIVATE_KEY_PATH);
    if (!xprv) {
        xprv = xkeys_1.computeRandomExtendedPrvKey();
        await storeService.set([{ path: exports.EXTENDED_PRIVATE_KEY_PATH, value: xprv }]);
    }
    try {
        return hdnode_1.fromExtendedKey(xprv).derivePath(constants_1.CF_PATH);
    }
    catch (e) {
        throw Error(`Invalid extended key supplied: ${utils_1.prettyPrintObject(e)}`);
    }
}
exports.getHDNode = getHDNode;
//# sourceMappingURL=signer.js.map
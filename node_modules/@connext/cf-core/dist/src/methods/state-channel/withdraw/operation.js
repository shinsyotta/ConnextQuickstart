"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const constants_1 = require("../../../constants");
const machine_1 = require("../../../machine");
const models_1 = require("../../../models");
async function runWithdrawProtocol(requestHandler, params) {
    const { publicIdentifier, protocolRunner, store } = requestHandler;
    const { multisigAddress, amount } = params;
    const tokenAddress = params.tokenAddress || constants_1.CONVENTION_FOR_ETH_TOKEN_ADDRESS;
    const [peerAddress] = await models_1.StateChannel.getPeersAddressFromChannel(publicIdentifier, store, multisigAddress);
    const stateChannel = await store.getStateChannel(multisigAddress);
    await protocolRunner.initiateProtocol(machine_1.Protocol.Withdraw, new Map([[stateChannel.multisigAddress, stateChannel]]), {
        amount,
        tokenAddress,
        recipient: params.recipient,
        initiatorXpub: publicIdentifier,
        responderXpub: peerAddress,
        multisigAddress: stateChannel.multisigAddress
    });
}
exports.runWithdrawProtocol = runWithdrawProtocol;
//# sourceMappingURL=operation.js.map